---
title: "Deforestation"
subtitle: "Is soybean use driving global deforestation?"
author: "Team 5 Look Alive <br> Krystal Hu, Kate Neal, Owen Henry"
institute: "Duke University"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
# Remove any packages from this list that you're not using
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
library(ggdark)
library(scales)
```

```{r setup, include=FALSE}
# set default theme for ggplot2
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 16))

# For better figure resolution
knitr::opts_chunk$set(
  fig.retina = 3, 
  dpi = 300, 
  fig.width = 6, 
  fig.asp = 0.618, 
  out.width = "70%"
  )
```

```{r load-data, include = FALSE}
forest <- read.csv("../data/forest.csv")
forest_area <- read.csv("../data/forest_area.csv")
brazil_loss <- read.csv("../data/brazil_loss.csv")
vegetable_oil <- read.csv("../data/vegetable_oil.csv")
soybean_use <- read.csv("../data/soybean_use.csv")
```


class: inverse, middle, center

# Question One
### What is the relationship between global soybean use and deforestation in Brazil? What countries are driving the growing of Brazilâ€™s commercial soybean crops?

---
## Code for Q1

```{r question_1_code}
forest_data <- merge(forest, forest_area, by=c("code", "year"))

world_soybean_use <- soybean_use %>%
  filter(entity == "World")

world_soybean_total <- world_soybean_use %>%
  rowwise() %>%
  mutate(total = sum(human_food, animal_feed, processed))

brazil_loss$total_brazil_forest_loss_hectares = rowSums(brazil_loss[,5:15])
brazil_loss_soybean_use <- merge(brazil_loss, world_soybean_total, by = c("year")) %>%
  select(year, total_brazil_forest_loss_hectares, total) %>%
  mutate(forest_loss_km2 = total / 100) %>%
  select(-4)

all_soybean_use <- soybean_use %>%
  rowwise() %>%
  mutate(total = sum(human_food, animal_feed, processed, na.rm = T))

soybean_total <- all_soybean_use %>%
  group_by(year) %>%
  summarise(world_soybean_use = sum(total, na.rm = T))

brazil_loss_soybean_use <- brazil_loss_soybean_use %>%
  pivot_longer(!year,
              names_to = "x1",
              values_to = "values")
```

---
## Plot for Q1

```{r question_1_plot, echo = FALSE, warning = FALSE, fig.alt = "interpretation."}
ggplot(brazil_loss_soybean_use, aes(x = year, y = values)) +
  geom_line() +
  facet_wrap(.~x1, ncol = 1, scales="free_y",
             labeller = as_labeller(c(total = "Soybean use (tons)",
                                      total_brazil_forest_loss_hectares = "Brazil's Forest Loss (hectares)"))) +
  scale_y_continuous(labels = unit_format(unit = "M", scale = 1e-6))  +
  ylab(NULL) +
  theme(strip.background = element_blank(),
        strip.placement = "outside",
        strip.text.y = element_text(face = "bold"))
```


---
class: inverse, middle, center

# Question Two
### How does the proportions of soybean production used for human food versus for feeding animal change over time? Is this change in proportions related to global deforestation development over time?

---

## Plan

--
### 1. Plot global soybean use share by type of usage

--

### 2. Plot the rate of global deforestation during the same time period

--

### 3. Observe and Compare
---
```{r question_2_code, echo = FALSE }
data2 <-soybean_use %>%
  group_by(year) %>%
  summarise(total_human = sum(human_food, na.rm = T),
            total_animal = sum(animal_feed, na.rm = T)) %>%
  pivot_longer(!year, 
              names_to = "use",
              values_to = "amount") 

 data2 <- data2 %>%
   group_by(year) %>%
   mutate(prop = amount / sum(amount))
 
```

## 1. Plot global soybean use share by type of usage

.pull-left[
- Start by grouping all entries in `soybean_use` by decades. For each decade category, add up the values for all entries under `human_food`, `animal_feed`,  and  `processed`.

- Create new variables `prop` that represents the proportions of soybean production used for human food and for animal feed out of the total each decade.

- Plot `prop` filled by the type of use in a stacked bar graph where the x-axis represents `decade` and the y-axis represents proportion percentage between 0 to 1.]

.pull-right[
```{r data2_table, echo = FALSE}
kable(head(data2), format = "html")
```
]
---

## Plot 1
.center[
```{r soybean_share_by_usage,fig.align = 'center', echo = FALSE, message = FALSE}
ggplot(data2, aes(fill = use, y = prop, x = year)) + 
  dark_theme_light() +  
  geom_bar(position ="fill", stat ="identity") +
  
  scale_x_continuous (name = "Year",
                     breaks = seq(from = 1961, to = 2013, by = 10)) +
  scale_y_continuous(name = "Proportion",
                     labels = c("0%", "25%", "50%","75%","100%")) +
  scale_fill_manual(values = c("orangered4", "goldenrod1"), 
                    name = NULL, labels = c("Animal food", "Human food")) +
  
  labs(title = "Global soybean production and use share between 1961-2013",
       subtitle = "By types of usage") +
  
  theme(plot.title = element_text(face = 'bold',size = 13),
        plot.subtitle = element_text( size = 12),
        legend.position = "bottom",
        legend.key.size = unit(.5, "cm"),
        legend.text = element_text(size = 10),
        axis.title.x = element_text(size = 10),
        axis.title.y = element_text(size = 10),
        axis.text.x = element_text( size = 7,face = "bold"),
        axis.text.y = element_text(margin = margin(t = .3, unit = "cm"), size = 7, face = "bold"))
```
]

---
## 2. Plot the rate of global deforestation 

.pull-left[
####Net forest conversion: The net change in forest area (loss and gain) describes the sum of all changes in forest area over a specific period of time (including reductions due to deforestation and disasters, and increases due to afforestation and expansion of forests during the period).

- Calculate share of global forest area by year
- Plot percentage of global forest area, `forest_area`, as points in the above graph and connect the dots with a distinguishable line. 
]

```{r forest_area__code, echo = FALSE }
forest2 <- forest %>%
  filter(entity == "World")
  
kable(head(forest2), format = "html")
```

.pull-right[
```{r global_deforestation_rate, echo = FALSE}
ggplot(data=forest2, aes(x = year, y=net_forest_conversion, group=1)) +
  geom_line()+
  geom_point()
```

]

---
```{r style-slides, echo = FALSE}
style_xaringan(
  title_slide_background_image = "img/deforestation_back.jpeg"
)
```



---

## Plots

```{r recode-species, echo = FALSE}
# In this chunk I'm doing a bunch of analysis that I don't want to present 
# in my slides. But I need the resulting data frame for a plot I want to present.
penguins_modified <- penguins %>%
  mutate(species = fct_other(species, keep = "Adelie"))
```

```{r plot-penguins, echo = FALSE, warning = FALSE, fig.alt = "Body mass vs. flipper lenght of Palmer Penguins for species Adelie and all the others combined together. There is a relatively strong, positive relationship between the two variables. The Adelie penguins are clustered together but they don't exhibit a different trend than the rest of the penguins."}
# Code hidden with echo = FALSE
# Uses modified penguins dataset from previous chunk
# Play around with height and width until you're happy with the look
ggplot(penguins_modified, aes(x = flipper_length_mm, y = body_mass_g, color = species)) +
  geom_point() + 
  theme_minimal()
```

---


class: inverse, middle, center

# A new section...

---

## Tables

If you want to generate a table, make sure it is in the HTML format (instead of Markdown or other formats), e.g.,

```{r penguins-table, echo = FALSE}
kable(head(penguins), format = "html")
```

---

## Images

```{r castle, echo = FALSE, out.width = "40%", fig.align = "center", fig.cap = "Image credit: Danielle Navarro, Percolate."}
include_graphics("img/watercolour_sys02_img32_percolate.jpg")
```

Or you can also include a full page image. See next slide.

---

background-image: url(img/watercolour_sys02_img32_percolate.jpg)

---

## Math Expressions

You can write LaTeX math expressions inside a pair of dollar signs, e.g. &#36;\alpha+\beta$ renders $\alpha+\beta$. You can use the display style with double dollar signs:

```
$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$
```

$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$

Limitations:

1. The source code of a LaTeX math expression must be in one line, unless it is inside a pair of double dollar signs, in which case the starting `$$` must appear in the very beginning of a line, followed immediately by a non-space character, and the ending `$$` must be at the end of a line, led by a non-space character;

1. There should not be spaces after the opening `$` or before the closing `$`.

1. Math does not work on the title slide (see [#61](https://github.com/yihui/xaringan/issues/61) for a workaround).

---

class: inverse, middle, center

# Wrap up

---
