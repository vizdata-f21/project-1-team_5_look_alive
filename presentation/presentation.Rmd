---
title: "Deforestation"
subtitle: "Is soybean use driving global deforestation?"
author: "Team 5 Look Alive <br> Krystal Hu, Kate Neal, Owen Henry"
institute: "Duke University"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
# Remove any packages from this list that you're not using
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
library(ggdark)
library(scales)
library(viridis)
library(gghighlight)
```

```{r setup, include=FALSE}
# set default theme for ggplot2
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 16))

# For better figure resolution
knitr::opts_chunk$set(
  fig.retina = 3, 
  dpi = 300, 
  fig.width = 6, 
  fig.asp = 0.618, 
  out.width = "70%"
  )
```

```{r load-data, include = FALSE}
forest <- read.csv("../data/forest.csv")
forest_area <- read.csv("../data/forest_area.csv")
brazil_loss <- read.csv("../data/brazil_loss.csv")
vegetable_oil <- read.csv("../data/vegetable_oil.csv")
soybean_use <- read.csv("../data/soybean_use.csv")
```

class: inverse, middle, center

# Question One
---
class: inverse, left

## Who, What, Why

--
### 1. Who is doing the deforesting?

--

### 2. What is driving the deforestation?

--

### 3. Why is the deforestation happening?




```{r question_1_code, include=F}
forest_data <- merge(forest, forest_area, by=c("code", "year"))

world_soybean_use <- soybean_use %>%
  filter(entity == "World")

world_soybean_total <- world_soybean_use %>%
  rowwise() %>%
  mutate(total = sum(human_food, animal_feed, processed))

brazil_loss$total_brazil_forest_loss_hectares = rowSums(brazil_loss[,5:15])
brazil_loss_soybean_use <- merge(brazil_loss, world_soybean_total, by = c("year")) %>%
  select(year, total_brazil_forest_loss_hectares, total) %>%
  mutate(forest_loss_km2 = -(total_brazil_forest_loss_hectares / 100),
         total_brazil_forest_loss_hectares = - total_brazil_forest_loss_hectares) %>%
  select(-4)

all_soybean_use <- soybean_use %>%
  rowwise() %>%
  mutate(total = sum(human_food, animal_feed, processed, na.rm = T))

soybean_total <- all_soybean_use %>%
  group_by(year) %>%
  summarise(world_soybean_use = sum(total, na.rm = T))

brazil_loss_soybean_use <- brazil_loss_soybean_use %>%
  pivot_longer(!year,
              names_to = "x1",
              values_to = "values")
```

---
## Brazil Forest Loss

```{r cumulative_brazil_only, echo=F}
annotation <- data.frame(
   x = c(2010),
   y = c(-5000000),
   label = c("Brazil has lost")
)
annotation2 <- data.frame(
   x = c(2010),
   y = c(-10200000),
   label = c("over 30 million")
)
annotation3 <- data.frame(
   x = c(2010),
   y = c(-18000000),
   label = c("hectares of forest\nsince 2000")
)

brazil_loss %>% select(year, total_brazil_forest_loss_hectares) %>%
  add_row(year = 2000, total_brazil_forest_loss_hectares = 0, .before = 1) %>%
  mutate(cum_sum = -(cumsum(total_brazil_forest_loss_hectares))) %>%
  ggplot() +
  geom_line(aes(year, cum_sum), size = 2, color = "#009739") +
  geom_hline(aes(yintercept = 0), color = "red", size = 2) +
  labs(title = "Forest loss since 2000 (hectares)", x = "Year", y = NULL) +
  scale_y_continuous(labels = label_number_si()) +
  scale_x_continuous() +
  geom_text(data=annotation, aes(x=x, y=y, label=label),
           color="black", 
           size=7 , angle=0) +
  geom_text(data=annotation2, aes(x=x, y=y, label=label),
           color="red", 
           size=7 , angle=0, fontface="bold") +
  geom_text(data=annotation3, aes(x=x, y=y, label=label),
           color="black", 
           size=7 , angle=0)
```

---
## Causes of Brazil's Deforestation


```{r drivers_of_brazil_deforstation, echo=F}
brazil_loss_no_total <- read.csv("../data/brazil_loss.csv") %>% select(-(1:3))
brazil_loss_no_total <- brazil_loss_no_total %>%
  pivot_longer(!year,
               names_to = "cause",
               values_to = "forest_lost") %>%
  mutate(cause = case_when(
    cause == "pasture" ~ "Pasture",
    cause == "fire" ~ "Fire",
    cause == "commercial_crops" ~ "Commercial Crops",
    cause == "selective_logging" ~ "Selective Logging",
    cause == "small_scale_clearing" ~ "Small-scale Farming",
    T ~ "Other"
  )) %>%
  group_by(cause, year) %>%
  summarise(sum = sum(forest_lost), .groups = 'drop')

ggplot(brazil_loss_no_total, aes(year, sum, fill = cause)) +
  geom_area() +
  scale_fill_manual(values = c("#E69F00", "#56B4E9", "#CC79A7", "#999999", "#0072B2", "#D55E00"))
```

---
## Causes of Brazil's Deforestation


```{r proportion_causes, echo=FALSE, message=F}
#https://www.r-graph-gallery.com/136-stacked-area-chart
brazil_loss_no_total  %>%
  group_by(year, cause) %>%
  summarise(n = sum(sum)) %>%
  mutate(percentage = n / sum(n)) %>%
  ggplot(aes(year, percentage, fill=cause)) + 
    geom_area() +
  scale_fill_manual(values = c("#E69F00", "#56B4E9", "#CC79A7", "#999999", "#0072B2", "#D55E00"))
```

---
## Soybean Use Over Time

```{r soybean_use_continents, echo=F, message=F, warning=F}
soy_use_by_continent <- soybean_use %>%
  filter(entity %in% c('Northern America', 'South America', 'Asia', 'Africa', 'Oceania', 'Europe')) %>%
  rowwise() %>%
  mutate(total = sum(human_food, animal_feed, processed, na.rm = T))

soy_use_by_continent %>%
  ggplot(aes(x = year, y = total, color = entity)) +
  geom_line(show.legend = F, size = 2) +
  gghighlight(max(total), max_highlight = 3, label_params = list(size = 3),
              unhighlighted_params = list(size = 1.2, colour =
                                            alpha("gray", 0.6))) +
  scale_y_continuous(labels = label_number_si()) +
  labs(y=NULL, x = "Year", title = "Tonnes of soybean used", subtitle = "by continent") +
  # okabe ito colors
  scale_color_manual(values = c("#E69F00", "#56B4E9", "#009E73"))
```


---
## Soybean Use Over Time


```{r soybean_use_countries, echo = FALSE, message=F, fig.alt = "interpretation."}
soy_use_by_country <- soybean_use %>%
  filter(!is.na(code),
         entity != "World") %>%
  rowwise() %>%
  mutate(total = sum(human_food, animal_feed, processed, na.rm = T))

# https://stackoverflow.com/questions/49438953/selective-labeling-for-ggplot-lines
# https://cran.r-project.org/web/packages/gghighlight/vignettes/gghighlight.html

soy_use_by_country %>%
  ggplot(aes(x = year, y = total, color = entity)) +
  geom_line(show.legend = F, size = 2) +
  gghighlight(max(total), max_highlight = 4,
              unhighlighted_params = list(size = 1.2, colour =
                                            alpha("gray", 0.6))) +
  scale_y_continuous(labels = label_number_si()) +
  labs(y = NULL, x = "Year", title = "Tonnes of soybean used", subtitle = "by country") +
  # flagcolorcodes.com
  scale_color_manual(values = c("#6CACE4", "#009739", "#EE1C25", "#0A3161"))
```



---
class: inverse, middle, center

# Question Two
### How does the proportions of soybean production used for human food versus for feeding animal change over time? Is this change in proportions related to global deforestation development over time?

---
class: inverse, left

## Analysis Plan

--
### 1. Plot global soybean use share by type of usage

--

### 2. Plot the rate of global deforestation during the same time period

--

### 3. Observe and Compare
---

```{r question_2_code, echo = FALSE }
data2 <-soybean_use %>%
  group_by(year) %>%
  summarise(total_human = sum(human_food, na.rm = T),
            total_animal = sum(animal_feed, na.rm = T)) %>%
  pivot_longer(!year, 
              names_to = "use",
              values_to = "amount") 

 data2 <- data2 %>%
   group_by(year) %>%
   mutate(prop = amount / sum(amount))
 
```

## I. Plot global soybean use share by type of usage

.pull-left[
- Start by grouping all entries in `soybean_use` by decades. For each decade category, add up the values for all entries under `human_food`, `animal_feed`,  and  `processed`.

- Create new variables `prop` that represents the proportions of soybean production used for human food and for animal feed out of the total each decade.

- Plot `prop` filled by the type of use in a stacked bar graph where the x-axis represents `decade` and the y-axis represents proportion percentage between 0 to 1.]

.pull-right[
```{r data2_table, echo = FALSE, fig.align='center'}
kable(head(data2), format = "html")
```
]
---
## I. Plot global soybean use share by type of usage


- Plot `prop` filled by the type of use in a stacked bar graph where the x-axis represents `decade` and the y-axis represents proportion percentage between 0 to 1.


```{r soybean_use_share, echo = FALSE, message = FALSE, fig.align='center'}

ggplot(data2, aes(fill = use, y = prop, x = year)) + 
  dark_theme_light() +  
  geom_bar(position ="fill", stat ="identity") +
  
  scale_x_continuous (name = "Year",
                     breaks = seq(from = 1961, to = 2013, by = 10)) +
  scale_y_continuous(name = "Proportion",
                     labels = c("0%", "25%", "50%","75%","100%")) +
  scale_fill_manual(values = c("orangered4", "goldenrod1"), 
                    name = NULL, labels = c("Animal food", "Human food")) +
  
  labs(title = "Global soybean production and use share between 1961-2013",
       subtitle = "By types of usage") +
  
  theme(plot.title = element_text(face = 'bold',size = 13),
        plot.subtitle = element_text( size = 12),
        legend.position = "bottom",
        legend.key.size = unit(.5, "cm"),
        legend.text = element_text(size = 10),
        legend.box.spacing = unit(0.2, "cm"),
        axis.title.x = element_text(size = 10),
        axis.title.y = element_text(size = 10),
        axis.text.x = element_text( size = 7,face = "bold"),
        axis.text.y = element_text(margin = margin(t = .3, unit = "cm"), size = 7, face = "bold"))

```

---
## II. Plot the rate of global deforestation 

.pull-left[
####Net forest conversion: The net change in forest area (loss and gain) describes the sum of all changes in forest area over a specific period of time (including reductions due to deforestation and disasters, and increases due to afforestation and expansion of forests during the period).

- Calculate share of global forest area by year
- Plot percentage of global forest area, `forest_area`, as points in the above graph and connect the dots with a distinguishable line. 
]

.pull-right[
```{r forest_area_table, echo = F, message = F}
forest2 <- forest %>%
  filter(entity == "World")
  
kable(head(forest2), format = "html")

ggplot(data = forest2) + 
  geom_area(aes(year, net_forest_conversion, color = entity), size = 1.5, fill = "lightgray", alpha = 0.5) +

  scale_y_continuous(labels = label_number_si()) +
  scale_color_manual(values = c("burlywood4")) +
  scale_y_reverse() +

  
  labs(title = "Global Net Forest Conversion (hectares)", x = "Year", y = NULL) +
  
  theme(legend.position = "none",
        plot.title = element_text(face = 'bold',size = 15),
        axis.title.x = element_text(size = 13),
        axis.title.y = element_text(size = 10),
        axis.text.x = element_text( size = 9,face = "bold"),
        axis.text.y = element_text(margin = margin(t = .3, unit = "cm"), size = 9, face = "bold"))
```
]

---

```{r style-slides, echo = FALSE}
style_xaringan(
  title_slide_background_image = "img/deforestation_back.jpeg"
)
```



class: inverse, middle, center

# A new section...


---

## Images

```{r castle, echo = FALSE, out.width = "40%", fig.align = "center", fig.cap = "Image credit: Danielle Navarro, Percolate."}
include_graphics("img/watercolour_sys02_img32_percolate.jpg")
```

Or you can also include a full page image. See next slide.

---

background-image: url(img/watercolour_sys02_img32_percolate.jpg)


